# Item Editor Qt6 - Developer Guide

## Project Overview

This is a Qt6 migration of the Item Editor application, maintaining **exact architectural fidelity** to the original C# WinForms codebase. The Item Editor is a specialized tool for editing game item databases in OTB (Open Tibia Binary) format, used by game developers working with Open Tibia-style MMORPG item systems.

### Key Information
- **Language**: C++17 with Qt6 framework
- **Original Source**: C# WinForms application (reference implementation)
- **Target Platform**: Cross-platform Qt6 application
- **Build System**: CMake with proper subdirectory organization
- **License**: MIT (matching original)
- **Supported Game Versions**: 8.00 - 10.77
- **File Formats**: OTB (server), DAT/SPR (client)

## Architecture Principles

### Exact Structural Mirroring
- Every C# directory has a corresponding Qt6 directory
- Every C# class has a corresponding Qt6 class with same name
- Same architectural patterns and responsibilities
- Functional parity while leveraging Qt6 features

### Component Migration Strategy
| C# WinForms | Qt6 Equivalent | Implementation |
|-------------|----------------|----------------|
| `UserControl` | `QWidget` | Custom widget base class |
| `Form` | `QDialog`/`QMainWindow` | Dialog or main window |
| `ListBox` | `QListWidget` | Standard list widget |
| `Graphics.DrawImage()` | `QPainter::drawPixmap()` | Custom painting in `paintEvent()` |
| `Assembly.LoadFrom()` | `QPluginLoader` | Dynamic plugin loading |

## Project Structure

### Core Directories
```
qt6_project/
├── src/                        # Main application source (mirrors C# Source/)
│   ├── main.cpp               # Application entry point (Program.cs equivalent)
│   ├── MainForm.cpp/.h/.ui    # Main window (MainForm.cs equivalent)
│   ├── Controls/              # Custom Qt widgets (exact mirror of C# Controls/)
│   ├── Dialogs/               # Dialog windows (exact mirror of C# Dialogs/)
│   ├── Helpers/               # Utility classes (exact mirror of C# Helpers/)
│   ├── Host/                  # Plugin hosting (exact mirror of C# Host/)
│   ├── PluginInterface/       # Plugin system (exact mirror of C# PluginInterface/)
│   └── Properties/            # Application metadata (C# Properties/ equivalent)
├── plugins/                   # Plugin implementations (exact mirror of C# plugins)
│   ├── PluginOne/
│   ├── PluginTwo/
│   └── PluginThree/
└── docs/                      # Documentation
    ├── MIGRATION_GUIDE.md     # Detailed migration documentation
    ├── PLUGIN_SYSTEM.md       # Plugin architecture guide
    └── UI_Documentation_Complete.md  # Complete UI reference
```

## Development Environment

### Prerequisites (Linux-Only Build)
- **Qt6** (6.4.2+) with Core, Widgets, Gui, Network, Xml modules
- **CMake** (3.16+) for Linux builds
- **C++17** compatible compiler (GCC 9+, Clang 10+)
- **Build tools**: build-essential, ninja-build, pkg-config
- **X11/Graphics**: libgl1-mesa-dev, libxcb-*-dev packages

### Build Instructions (Linux)
```bash
# Install rich library first (required for beautiful UI)
pip install rich

# Use the professional all-in-one build script
python3 build_linux_all_in_one.py

# Or manual build:
cmake -B build -S . -DCMAKE_PREFIX_PATH=/usr/lib/qt6
cmake --build build --parallel $(nproc)

# Run application
./build/bin/ItemEditor
```

### Professional Linux Build Script Features
- **Rich Console UI**: Beautiful colored output with progress bars and panels
- **Comprehensive Logging**: All build activities logged to `logs/` directory with timestamps
- **Smart Package Management**: Automatic installation of all required Qt6 and X11 packages
- **Error Handling**: Professional error reporting with detailed diagnostics
- **Build Verification**: Automatic verification of prerequisites, Qt6 installation, and build outputs
- **Progress Tracking**: Real-time progress bars for package installation and compilation
- **Fallback Options**: Ninja generator fallback if Unix Makefiles fail
- **Professional Presentation**: Styled panels, tables, and status indicators

### Linux-Specific Fixes Applied
- **Removed Windows/macOS CMake configurations**: WIN32_EXECUTABLE, MACOSX_BUNDLE
- **Fixed Qt6 discovery**: Proper CMAKE_PREFIX_PATH for Ubuntu/Debian
- **Optimized for GCC/Clang**: Linux-specific compiler flags
- **Package management**: Comprehensive apt package installation
- **Error handling**: Better CMake error reporting and fallback options

## Coding Standards and Conventions

### Naming Conventions
- **Classes**: PascalCase (e.g., `ClientItemView`, `ServerItemListBox`)
- **Methods**: camelCase (e.g., `getClientItem()`, `loadPlugin()`)
- **Member Variables**: m_camelCase (e.g., `m_clientItem`, `m_pluginPath`)
- **Files**: Match class names (e.g., `ClientItemView.cpp`, `ClientItemView.h`)
- **Namespaces**: Use `ItemEditor` namespace for all project classes

### Code Organization
- **Header Guards**: Use `#pragma once` or `#ifndef` include guards
- **CMake Structure**: Each directory has its own `CMakeLists.txt`
- **Forward Declarations**: Minimize includes with forward declarations
- **Qt6 Patterns**: Use modern Qt6 signal/slot syntax and best practices

### Qt6 Development Standards
- **Signal/Slot Syntax**: Use modern syntax `connect(sender, &Class::signal, receiver, &Class::slot)`
- **Resource Management**: Use Qt's parent-child ownership model for QObjects
- **Memory Management**: Use smart pointers for non-QObject classes
- **Plugin System**: Use `Q_DECLARE_INTERFACE` and `QPluginLoader`
- **MOC Requirements**: Use `Q_OBJECT` macro for all QObject-derived classes

## CMake Build System

### Structure
- **Root CMakeLists.txt**: Main project configuration with Qt6 setup
- **Component Libraries**: Each src/ subdirectory builds as static library
- **Plugin System**: Separate CMake targets for each plugin
- **Cross-Platform**: Windows, macOS, and Linux support

### Library Dependencies
```cmake
# Main application links to component libraries
target_link_libraries(ItemEditor PRIVATE
    Qt6::Core Qt6::Widgets Qt6::Gui Qt6::Network Qt6::Xml
    ItemEditorControls
    ItemEditorDialogs
    ItemEditorHelpers
    ItemEditorProperties
    ItemEditorHost
    ItemEditorPluginInterface
)
```

## Plugin Architecture

### Qt6 Plugin System
- **Interface Definition**: `Q_DECLARE_INTERFACE` for plugin contracts
- **Plugin Loading**: `QPluginLoader` for dynamic loading
- **Service Architecture**: Qt service provider pattern
- **Version Management**: Maintain backward compatibility

### Plugin Development
```cpp
class Plugin : public QObject, public ItemEditor::IPlugin
{
    Q_OBJECT
    Q_PLUGIN_METADATA(IID "org.ottools.ItemEditor.IPlugin/1.0" FILE "PluginName.json")
    Q_INTERFACES(ItemEditor::IPlugin)

public:
    // Implement all IPlugin methods
};
```

### Plugin Metadata (PluginName.json)
```json
{
    "IID": "org.ottools.ItemEditor.IPlugin/1.0",
    "MetaData": {
        "name": "Plugin Name",
        "version": "1.0.0",
        "description": "Plugin description",
        "supportedClients": ["10.77", "10.78"]
    }
}
```

## UI Development

### Custom Controls
- **ClientItemView**: Custom paint widget for item sprite display
- **ServerItemListBox**: Custom list widget with item thumbnails
- **FlagCheckBox**: Custom checkbox for item flags
- **ListBase**: Base class for custom list controls

### Theme System
- **Dark Theme**: Qt stylesheet in `src/Properties/styles/dark.qss`
- **Light Theme**: Qt stylesheet in `src/Properties/styles/light.qss`
- **DarkUI Migration**: Replaces C# DarkUI library with Qt stylesheets

### Dialog System
All dialogs follow consistent patterns:
- Inherit from `QDialog`
- Use `.ui` files for complex layouts
- Implement proper signal/slot connections
- Follow C# dialog naming and functionality

## File Format Support

### Core Formats
- **OTB** - Open Tibia Binary (server item database)
- **DAT** - Client data files (item definitions)
- **SPR** - Sprite files (item graphics)

### Implementation Status
- **Framework**: Complete Qt6 migration
- **File Parsing**: Partial implementation in progress
- **Plugin Integration**: Core infrastructure complete

## Testing and Quality

### Performance Considerations
- **Memory Management**: Qt parent-child ownership model
- **Caching**: Sprite caching in ClientItemView
- **Optimization**: Build performance optimizations in CMake

### Build Configurations
- **Debug**: Development builds with debugging symbols
- **Release**: Optimized production builds with `/O2` (MSVC) or `-O3` (GCC/Clang)

## Development Workflow

### Getting Started
1. Set up Qt6 development environment
2. Clone repository and examine C# reference implementation
3. Begin with foundation components, then move to UI components
4. Follow exact architectural mirroring of C# codebase

### Best Practices
- **Maintain Architectural Fidelity**: Preserve C# class structure and responsibilities
- **Document Migration Decisions**: Record implementation choices and rationale
- **Test Cross-Platform**: Ensure functionality on Windows, macOS, and Linux
- **Follow Qt6 Patterns**: Use modern Qt6 features while maintaining compatibility

### Code Review Guidelines
- Verify exact structural mirroring of C# components
- Check proper Qt6 signal/slot usage
- Ensure CMake integration follows project patterns
- Validate plugin interface compatibility

## Important Files and Locations

### Core Application Files
- `src/main.cpp` - Application entry point (mirrors C# Program.cs)
- `src/MainForm.h/.cpp/.ui` - Main window implementation
- `src/PluginInterface/IPlugin.h` - Plugin interface definition

### Build System Files
- `CMakeLists.txt` - Root build configuration
- `src/CMakeLists.txt` - Main application build
- `plugins/CMakeLists.txt` - Plugin system build

### Documentation
- `docs/MIGRATION_GUIDE.md` - Detailed migration documentation
- `docs/PLUGIN_SYSTEM.md` - Plugin architecture guide
- `docs/UI_Documentation_Complete.md` - Complete UI reference from C# version

### Configuration Files
- `src/Properties/version.h` - Version information (mirrors C# AssemblyInfo.cs)
- `src/Properties/settings.h` - Application settings
- `src/Properties/application.qrc` - Qt resource file

## Migration Status

### Completed Components
- ✅ Project structure and CMake build system
- ✅ Core application framework (main.cpp, MainForm)
- ✅ Plugin interface and loading system
- ✅ Custom controls foundation
- ✅ Dialog system framework
- ✅ Helper utilities
- ✅ Theme system (Qt stylesheets)

### In Progress
- 🔄 File format parsing implementations
- 🔄 Plugin concrete implementations
- 🔄 Complete UI functionality

### Future Work
- ⏳ Advanced editing features
- ⏳ Performance optimizations
- ⏳ Extended testing coverage

---

*This guide is actively maintained and updated as the migration progresses. For specific implementation details, refer to the documentation in the `docs/` directory and examine the C# reference implementation for exact behavioral requirements.*